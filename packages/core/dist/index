"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const w="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",S=Object.fromEntries(Array.from(w).map((e,t)=>[e,t])),C={luhn:b,mod10:b,mod7:e=>v(e,7),mod11:e=>T(e),s10:E,mod_37_36:_,mod10_3_1:x};function b(e){let t=0,r=!1;for(let n=e.length-1;n>=0;n--){let o=e.charCodeAt(n)-48;if(o<0||o>9)return!1;r&&(o*=2,o>9&&(o-=9)),t+=o,r=!r}return t%10===0}function v(e,t){let r=0;for(let n=0;n<e.length;n++){const o=e.charCodeAt(n)-48;if(o<0||o>9)return!1;r=(r*10+o)%t}return r===0}function x(e){if(!/^\d+$/.test(e)||e.length<2)return!1;const t=e.charCodeAt(e.length-1)-48;let r=0,n=1;for(let u=e.length-2;u>=0;u--,n++){const l=e.charCodeAt(u)-48;if(l<0||l>9)return!1;const s=n%2===0?3:1;r+=l*s}return(10-r%10)%10===t}function T(e){const t=[2,3,4,5,6,7];let r=0,n=0;for(let o=e.length-1;o>=0;o--){const u=e.charCodeAt(o)-48;if(u<0||u>9)return!1;r+=u*t[n],n=(n+1)%t.length}return r%11===0}function _(e){let t=36;const r=e.toUpperCase();for(let n=0;n<r.length;n++){const o=S[r[n]];if(o===void 0)return!1;t=(t+o)*2%37}return t===1}function E(e){const t=[8,6,4,2,3,5,9,7];if(e.length!==9)return!1;const r=e.charCodeAt(8)-48;if(r<0||r>9)return!1;let n=0;for(let s=0;s<8;s++){const c=e.charCodeAt(s)-48;if(c<0||c>9)return!1;n+=c*t[s]}const u=(11-n%11)%11;return(u===10?0:u)===r}const y=[],N="0.1.3";function B(e,t=""){return new RegExp(e,t)}function A(e){y.push(e)}function F(e){for(const t of e){const r=t.patterns.map(n=>({note:n.note,regex:B(n.regex,n.flags??""),checksum:n.checksum,countries:n.countries,baseScore:n.baseScore}));A({slug:t.slug,name:t.name,group:t.group,patterns:r,markets:t.markets,trackingUrlTemplate:t.trackingUrlTemplate})}}function L(e,t={}){var l;const r=[],n=e.trim(),o=n.replace(/\s+/g,"");if(!n)return{primary:null,candidates:[],warnings:["Empty tracking number"]};const u=[];e:for(const s of y)if(!(t.carrierWhitelist&&!t.carrierWhitelist.includes(s.slug)))for(const c of s.patterns){const g=n.match(c.regex);if(!g)continue;let d=c.baseScore??2;const f=["regex"];if(c.checksum){const m=c.checksum.group??0,i=m===0?n:g[m]??"",a=c.checksum.fn,p=c.checksum.customFnName;let h="";a==="mod_37_36"?h=i.replace(/\s+/g,"").toUpperCase():h=i.replace(/\D/g,"");const k=a==="custom"&&p?C[p]??null:C[a];k&&h&&k(h)?(d+=3,f.push("checksum")):f.push("checksum-failed")}if(c.countries&&t){const m=c.countries.boost??1,{originCountry:i,destinationCountry:a}=t;c.countries.kind==="origin"&&i&&c.countries.codes.includes(i)&&(d+=m,f.push("origin-match")),c.countries.kind==="destination"&&a&&c.countries.codes.includes(a)&&(d+=m,f.push("dest-match")),c.countries.kind==="either"&&(i&&c.countries.codes.includes(i)||a&&c.countries.codes.includes(a))&&(d+=m,f.push("country-match"))}(l=s.markets)!=null&&l.primaryMarkets&&t.localeBoost&&s.markets.primaryMarkets.some(i=>t.localeBoost.includes(i))&&(d+=s.markets.extraBoost??1,f.push("market-boost"));const U=s.trackingUrlTemplate?s.trackingUrlTemplate.replace("%s",o):void 0;u.push({slug:s.slug,name:s.name,score:d,reasons:f,trackingUrl:U});continue e}return u.sort((s,c)=>c.score-s.score),{primary:u[0]??null,candidates:u,warnings:r}}exports.detect=L;exports.load=F;exports.register=A;exports.version=N;
